(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{5811:function(s,t,a){s.exports=a.p+"assets/img/image-20210220222103787.52f6834b.png"},5812:function(s,t,a){s.exports=a.p+"assets/img/image-20210220214851409.cb043828.png"},5813:function(s,t,a){s.exports=a.p+"assets/img/image-20210309091528931.5ad39045.png"},5814:function(s,t,a){s.exports=a.p+"assets/img/image-20210309092038850.dbd5b386.png"},5815:function(s,t,a){s.exports=a.p+"assets/img/image-20210309092558579.77783b06.png"},5816:function(s,t,a){s.exports=a.p+"assets/img/image-20210221101152845.2fcdd0fa.png"},5817:function(s,t,a){s.exports=a.p+"assets/img/image-20210221103114013.515786e5.png"},5818:function(s,t,a){s.exports=a.p+"assets/img/image-20210308005644520.a077cb2b.png"},6214:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"浏览器底层原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器底层原理"}},[s._v("#")]),s._v(" 浏览器底层原理")]),s._v(" "),n("h2",{attrs:{id:"_1-浏览器是如何解析css选择器的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-浏览器是如何解析css选择器的"}},[s._v("#")]),s._v(" 1. 浏览器是如何解析CSS选择器的？")]),s._v(" "),n("p",[s._v("在生成渲染树的过程中，渲染引擎会根据选择器提供的信息来遍历 DOM 树，找到对应的 DOM 节点后将样式规则附加到上面。")]),s._v(" "),n("p",[s._v("来看一段样式选择器代码、以及一段要应用样式的 HTML：")]),s._v(" "),n("div",{staticClass:"language-css line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-css"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[s._v(".mod-nav h3 span")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("font-size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 16px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- \n  注意: 浏览器解析选择器, 是从右往左解析的!!!\n  从左往右解析, 还是从右往左解析, 最终选中的元素效果是一样的! 区别: 在于性能!!!!\n    1. 从左往右, 找后代, 其实是在进行所有后代子树的遍历, 成本非常高 (尤其是子辈元素非常多时, 非常耗成本)\n    2. 从右往左, 找祖辈, 一共一个元素, 就没有几个祖辈, 效率很高! (匹配起来快)\n  --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mod-nav"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("h3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("span")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("标题"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("span")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("h3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  \n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ul")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("a")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("#"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("项目一"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("a")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("a")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("#"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("项目一"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("a")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("a")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("href")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("#"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("项目一"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("a")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("ul")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    ...\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("渲染引擎是怎么根据以上样式选择器去遍历这个 DOM 树的呢？是按照从左往右的选择器顺序去匹配，还是从右往左呢？")]),s._v(" "),n("p",[s._v("为了更直观的观查，我们先将这棵 DOM 树先绘制成图：")]),s._v(" "),n("img",{staticStyle:{zoom:"30%"},attrs:{src:a(5811),alt:"image-20210220222103787"}}),s._v(" "),n("p",[s._v("然后我们来对比一下两种顺序的匹配：")]),s._v(" "),n("p",[n("strong",[s._v("从左往右："),n("code",[s._v(".mod-nav => h3 => span")])])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("遍历所有的元素, 找有 .mod-nav 类的节点")])]),s._v(" "),n("li",[n("p",[s._v("从 "),n("code",[s._v(".mod-nav")]),s._v(" 开始遍历所有的⼦孙节点 "),n("code",[s._v("header")]),s._v("、"),n("code",[s._v("div")]),s._v(" 、 "),n("code",[s._v("h3")]),s._v("、 "),n("code",[s._v("ul")]),s._v(" ....")]),s._v(" "),n("p",[s._v("遍历所有的后代元素后, 知道了, 整个子孙后代只有一个 h3")])]),s._v(" "),n("li",[n("p",[s._v("找到 "),n("code",[s._v("h3")]),s._v(" ,  还要继续重新遍历 "),n("code",[s._v("h3")]),s._v(" 的所有子孙节点, 去找 "),n("code",[s._v("span")])]),s._v(" "),n("p",[s._v("...")])])]),s._v(" "),n("p",[n("strong",[s._v("问题: 会进行大量树形结构子孙节点的遍历, 这是非常消耗成本的!")])]),s._v(" "),n("p",[n("strong",[s._v("这在真实页面中⼀棵 DOM 树的节点成百上千的情况下，这种遍历方式的效率会非常的低，根本不适合采用。")])]),s._v(" "),n("p",[n("strong",[s._v("从右往左："),n("code",[s._v("span => h3 => .mod-nav")])])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("先找到所有的 "),n("code",[s._v("span")]),s._v(" 节点 ，然后基于每⼀个 "),n("code",[s._v("span")]),s._v(" 再向上查找 "),n("code",[s._v("h3")])])]),s._v(" "),n("li",[n("p",[s._v("由 "),n("code",[s._v("h3")]),s._v(" 再向上查找 "),n("code",[s._v(".mod-nav")]),s._v(" 的节点")])]),s._v(" "),n("li",[n("p",[s._v("最后触及根元素 "),n("code",[s._v("html")]),s._v(" 结束该分⽀遍历")]),s._v(" "),n("p",[s._v("...")])])]),s._v(" "),n("p",[s._v("从右向左的匹配规则, 只有第一次会遍历所有元素找节点, 而剩下的就是在看父辈祖辈是否满足选择器的条件, 匹配效率大大提升!")]),s._v(" "),n("p",[s._v("因此，浏览器遵循 “从右往左” 的规则来解析 CSS 选择器！")]),s._v(" "),n("h2",{attrs:{id:"_2-浏览器是如何进行界面渲染的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-浏览器是如何进行界面渲染的"}},[s._v("#")]),s._v(" 2. 浏览器是如何进行界面渲染的？")]),s._v(" "),n("p",[s._v("不同的渲染引擎的具体做法稍有差异，但是大体流程都是差不多的，下面以 chrome渲染引擎 的 渲染流程来说明：")]),s._v(" "),n("img",{staticStyle:{zoom:"45%"},attrs:{src:a(5812),alt:"image-20210220214851409"}}),s._v(" "),n("p",[s._v("上图展示的流程是：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("获取 HTML ⽂件并进⾏解析，生成一棵 DOM 树（DOM Tree）")])]),s._v(" "),n("li",[n("p",[s._v("解析 HTML 的同时也会解析 CSS，⽣成样式规则（Style Rules）")])]),s._v(" "),n("li",[n("p",[s._v("根据 DOM 树和样式规则，生成一棵渲染树（Render Tree）")])]),s._v(" "),n("li",[n("p",[s._v("进行布局（Layout）(重排)，即为每个节点分配⼀个在屏幕上应显示的确切坐标位置")])]),s._v(" "),n("li",[n("p",[s._v("进⾏绘制（Paint）(重绘)，遍历渲染树节点，调⽤ GPU(图形处理器) 将元素呈现出来")])])]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 浏览器渲染的整体流程:")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 解析最新的html结构, 生成DOM树")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 同时解析最新的css样式, 生成样式规则rules")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 将DOM树 和 样式规则rules结合 => 生成render Tree 渲染树")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. 基于渲染树, 进行运算布局 (重排)")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5. 进行绘制 (重绘)")]),s._v("\n")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"_3-重绘-repaint-和重排-回流reflow-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-重绘-repaint-和重排-回流reflow-是什么"}},[s._v("#")]),s._v(" 3. 重绘(repaint)和重排(回流reflow)是什么?")]),s._v(" "),n("p",[n("strong",[s._v("重排")])]),s._v(" "),n("p",[s._v("重排是指部分或整个渲染树需要重新分析，并且节点的尺⼨需要重新计算。")]),s._v(" "),n("p",[s._v("表现为 "),n("strong",[s._v("重新⽣成布局，重新排列元素。")])]),s._v(" "),n("p",[n("strong",[s._v("重绘")])]),s._v(" "),n("p",[s._v("重绘是由于节点的⼏何属性发⽣改变，或由于样式发⽣改变（例如：改变元素背景⾊）。")]),s._v(" "),n("p",[s._v("表现为某些元素的外观被改变。或者重排后, 进行重新绘制!")]),s._v(" "),n("p",[n("strong",[s._v("两者的关系")])]),s._v(" "),n("blockquote",[n("p",[s._v("重绘不⼀定会出现重排，重排必定会触发重绘。")])]),s._v(" "),n("p",[s._v("每个页面至少需要一次回流+重绘。(初始化渲染)")]),s._v(" "),n("p",[s._v("重排和重绘的代价都很⾼昂，频繁重排重绘, 会破坏⽤户体验、让界面显示变迟缓。")]),s._v(" "),n("p",[s._v("我们需要尽可能避免频繁触发重排和重绘, 尤其是重排")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- \n  重绘和重排\n    1. 重排: 对布局重新计算排布, 更新布局\n        何时会触发重排: (布局发生改变)\n\n    2. 重绘: 对界面, 进行渲染绘制\n        何时触发重绘: \n          (1) 改变了不影响布局的样式(backgroundColor color), 只触发重绘\n          (2) 改变布局了, 布局更新后, 也会触发重绘\n\n  重绘和重排的关系:\n    1. 重绘不一定会触发重排, 比如: 只改了背景色\n    2. 只要重排了, 必然触发重绘!!!\n\n--\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h2",{attrs:{id:"_4-何时会触发重排"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-何时会触发重排"}},[s._v("#")]),s._v(" 4. 何时会触发重排？")]),s._v(" "),n("p",[s._v("重排什么时候发生？")]),s._v(" "),n("p",[s._v("1、添加或者删除可见的DOM元素；")]),s._v(" "),n("p",[s._v("2、元素位置改变；")]),s._v(" "),n("p",[s._v("3、元素尺寸改变——边距、填充、边框、宽度和高度")]),s._v(" "),n("p",[s._v("4、内容改变——比如文本改变或者图片大小改变而引起的计算值宽度和高度改变；")]),s._v(" "),n("p",[s._v("5、页面渲染初始化；")]),s._v(" "),n("p",[s._v("6、浏览器窗口尺寸改变——resize事件发生时；")]),s._v(" "),n("h2",{attrs:{id:"_5-浏览器对重绘重排的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-浏览器对重绘重排的优化"}},[s._v("#")]),s._v(" 5. 浏览器对重绘重排的优化")]),s._v(" "),n("p",[s._v("思考下述代码的重绘重排过程!")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" s "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("padding "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2px"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 重排 + 重绘")]),s._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("border "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1px solid red"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 再一次 重排 + 重绘")]),s._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("color "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blue"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 再一次重绘")]),s._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("backgroundColor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#ccc"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 再一次 重绘")]),s._v("\ns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fontSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"14px"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 再一次 重排 + 重绘")]),s._v("\ndocument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createTextNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'abc!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 添加node，再一次 重排 + 重绘")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("聪明的浏览器:")])]),s._v(" "),n("p",[s._v("从上个实例代码中可以看到几行简单的JS代码就引起了 4次重排、6次重绘。")]),s._v(" "),n("p",[s._v("而且我们也知道重排的花销也不小，如果每句JS操作都去重排重绘的话，浏览器可能就会受不了!")]),s._v(" "),n("p",[s._v("所以浏览器会优化这些操作，"),n("strong",[s._v("浏览器会维护1个队列，把所有会引起重排、重绘的操作放入这个队列")]),s._v("，")]),s._v(" "),n("p",[n("strong",[s._v("等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，进行一个"),n("code",[s._v("批处理")]),s._v("。")])]),s._v(" "),n("p",[s._v("这样就会让多次的重排、重绘变成了一次重排重绘。")]),s._v(" "),n("p",[s._v("虽然有了浏览器的优化，但有时候我们写的一些代码可能会强制浏览器提前flush队列，这样浏览器的优化可能起不到作用了。")]),s._v(" "),n("p",[s._v("比如当你请求向浏览器获取一些样式信息的时候(保证获取结果的准确性)，就会让浏览器flush队列")]),s._v(" "),n("ol",[n("li",[s._v("offsetTop, offsetLeft, offsetWidth, offsetHeight")]),s._v(" "),n("li",[s._v("scrollTop/Left/Width/Height")]),s._v(" "),n("li",[s._v("clientTop/Left/Width/Height")]),s._v(" "),n("li",[s._v("请求了getComputedStyle()")]),s._v(" "),n("li",[s._v("....")])]),s._v(" "),n("p",[n("strong",[s._v("猜一猜, 页面效果是什么:")])]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("lang")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("UTF-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Document"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("style")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token style"}},[n("span",{pre:!0,attrs:{class:"token language-css"}},[s._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[s._v("div")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("width")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 200px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("height")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 200px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("transition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("background-color")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pink"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  ")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("style")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 问: 页面效果是什么? ")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 选择题:")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 直接显示一个 400*400 的盒子 (实际效果)")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 一个动画, 从 200*200 过渡到 400*400 (想看的效果)")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 浏览器做了优化, 对所有进行了重绘和重排的操作, 进行一次批处理")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" div "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("querySelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 宏1")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// console.log(div.offsetWidth) // 200 * 400, 为了保证计算值的获取准确性, 这里一会提前刷新浏览器队列")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    div"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("height "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'400px'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 宏2")]),s._v("\n    div"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("width "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'400px'")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 宏2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果了解了重绘和重排, 了解了浏览器的优化策略")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 要进行性能优化 => 角度: 尽可能的减少重绘 + 重排, 尤其是重排")]),s._v("\n")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h2",{attrs:{id:"_6-重绘重排角度-我们应该如何优化页面渲染性能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-重绘重排角度-我们应该如何优化页面渲染性能"}},[s._v("#")]),s._v(" 6. 重绘重排角度, 我们应该如何优化页面渲染性能 ？")]),s._v(" "),n("p",[s._v("优化页面渲染性能的角度:  尽可能减少重绘和重排的次数")]),s._v(" "),n("p",[s._v("主要有几大方式来避免：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("1 集中修改样式 (这样可以尽可能利用浏览器的优化机制, 一次重排重绘就完成渲染)")])]),s._v(" "),n("li",[n("p",[s._v("2 尽量避免在遍历循环中, 进行元素 offsetTop 等样式值的获取操作, 会强制浏览器刷新队列, 进行渲染")])]),s._v(" "),n("li",[n("p",[s._v("3 利用 transform 实现动画变化效果, 去代替 left top 的变换 (轮播图等)")]),s._v(" "),n("p",[s._v("transform变换, 只是视觉效果! 不会影响到其他盒子,  只触发了自己的重绘")])]),s._v(" "),n("li",[n("p",[s._v("4 使用文档碎片（DocumentFragment）可以用于批量处理, 创建元素")])])]),s._v(" "),n("p",[n("strong",[s._v("文档碎片的理解:")])]),s._v(" "),n("p",[n("strong",[s._v("documentFragment")]),s._v("是一个保存多个元素的容器对象（保存在内存）当更新其中的一个或者多个元素时，页面不会更新。")]),s._v(" "),n("p",[s._v("当documentFragment容器中保存的所有元素操作完毕了,  只有将其插入到页面中才会更新页面。")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("lang")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("UTF-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Document"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ul")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("ul")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// let ul = document.getElementById("box")')]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// for (let i = 0; i < 20; i++) {")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//   let li = document.createElement("li")')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//   li.innerHTML = "index: " + i')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   ul.appendChild(li)")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// }")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// let ul = document.getElementById("box")')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// let fragment = document.createDocumentFragment() // 文档碎片")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// for (let i = 0; i < 20; i++) {")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//     let li = document.createElement("li")')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//     li.innerHTML = "index: " + i')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//     fragment.appendChild(li)")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// }")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ul.appendChild(fragment)")]),s._v("\n")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[s._v("vue底层渲染更新, 就用了  document.createDocumentFragment")]),s._v(" "),n("h2",{attrs:{id:"_7-前端如何实现即时通讯-websocket"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-前端如何实现即时通讯-websocket"}},[s._v("#")]),s._v(" 7. 前端如何实现即时通讯？websocket")]),s._v(" "),n("p",[n("code",[s._v("严格意义上: HTTP协议只能做到客户端请求服务器, 服务器做出响应, 做不到让服务器主动给客户端推送消息!")])]),s._v(" "),n("p",[n("strong",[s._v("那么如果服务器数据更新了, 想要即时通知到客户端怎么办呢 ? (即时通信需求)")])]),s._v(" "),n("p",[s._v("即时通信需求: 服务器数据一有更新, 希望推送给到浏览器")]),s._v(" "),n("p",[s._v("提问的回答重心:")]),s._v(" "),n("ol",[n("li",[s._v("即时通信有哪些方案?")]),s._v(" "),n("li",[s._v("为什么使用了其中某一个方案! websocket")])]),s._v(" "),n("p",[s._v("基于Web的前端，存在以下几种可实现即时通讯的方式：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("短轮询 (历史方案)")]),s._v(" "),n("p",[s._v("开个定时器, 每隔一段时间发请求 (实时性不强)")])]),s._v(" "),n("li",[n("p",[s._v("Comet - ajax长轮询(历史方案)")]),s._v(" "),n("p",[s._v("发送一个请求, 服务器只要数据不更新, 就一直阻塞  (服务器压力过大)")])]),s._v(" "),n("li",[n("p",[s._v("SSE")]),s._v(" "),n("p",[s._v("(利用了http协议, 流数据的传输, 并不是严格意义的双向通信, 无法复用连接)")])]),s._v(" "),n("li",[n("p",[s._v("WebSocket (主流)")]),s._v(" "),n("p",[s._v("性能和效率都高!")])])]),s._v(" "),n("p",[n("strong",[s._v("短轮询")]),s._v(" (历史方案)")]),s._v(" "),n("p",[s._v("短轮询就是客户端定时发送请求，获取服务器上的最新数据。不是真正的即时通讯，但一定程度上可以模拟即时通讯的效果。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(5813),alt:"image-20210309091528931"}})]),s._v(" "),n("p",[s._v("优缺点：")]),s._v(" "),n("ul",[n("li",[s._v("优点：浏览器兼容性好，实现简单  setInterval")]),s._v(" "),n("li",[s._v("缺点：实时性不高，资源消耗高，存在较多无用请求，影响性能")])]),s._v(" "),n("p",[n("strong",[s._v("Comet - ajax长轮询")]),s._v(" (历史方案)")]),s._v(" "),n("p",[s._v("短轮询的实时性, 着实太差,  所以 Comet 技术方案应运而生, 用以实现即时通讯")]),s._v(" "),n("p",[s._v("使用 Ajax 长轮询（long-polling）")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("浏览器发出XMLHttpRequest 请求，服务器端接收到请求后，会阻塞请求直到有数据或者超时才返回")])]),s._v(" "),n("li",[n("p",[s._v("浏览器JS在处理返回信息(有数据或者超时) 后再次发出请求。服务器收到请求后, 会再次阻塞到有数据或者超时")]),s._v(" "),n("p",[s._v("...")])])]),s._v(" "),n("p",[n("img",{attrs:{src:a(5814),alt:"image-20210309092038850"}})]),s._v(" "),n("p",[s._v("优缺点：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("优点：浏览器兼容性好，"),n("strong",[s._v("即时性好")]),s._v("，"),n("strong",[s._v("不存在⽆⽤请求")])])]),s._v(" "),n("li",[n("p",[s._v("缺点："),n("strong",[s._v("服务器压力较大")]),s._v("（维护⻓连接会消耗较多服务器资源）")])])]),s._v(" "),n("p",[n("strong",[s._v("SSE")])]),s._v(" "),n("p",[s._v("服务端推送事件（Server-Sent Event），它是⼀种基于HTTP协议,  允许服务端向客户端推送新数据的 HTML5 技术。")]),s._v(" "),n("p",[n("strong",[s._v("问题: HTTP协议 不是 无法做到服务器主动向客户端推送消息么?")])]),s._v(" "),n("p",[s._v("这些 SSE 采用了一些小技巧! 详细见 "),n("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考文章：SSE教程"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("img",{attrs:{src:a(5815),alt:"image-20210309092558579"}})]),s._v(" "),n("p",[s._v("优缺点：")]),s._v(" "),n("ul",[n("li",[s._v("优点：基于 HTTP，无需太多改造就能使⽤；相比 WebSocket 要简单一些")]),s._v(" "),n("li",[s._v("缺点：基于⽂本传输，效率没有 WebSocket ⾼；基于HTTP协议, 不是严格的双向通信")])]),s._v(" "),n("p",[n("strong",[s._v("WebSocket")]),s._v(" (目前主流)")]),s._v(" "),n("p",[s._v("这是基于 TCP 协议的全新、独⽴的协议，作⽤是在服务器和客户端之间建⽴实时的双向通信。")]),s._v(" "),n("p",[s._v("WebSocket 协议与 HTTP 协议保持兼容，但它不会融⼊ HTTP 协议，仅作为 HTML 5 的⼀部分。")]),s._v(" "),n("p",[s._v("优缺点：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("优点：真正意义上的双向实时通信，性能好、延迟低")])]),s._v(" "),n("li",[n("p",[s._v("缺点：由于是独⽴于 HTTP 的协议，因此要使用的话需要对项⽬作改造；")]),s._v(" "),n("p",[s._v("使⽤复杂度会⾼一些，通常需要引⼊成熟的库 (如: Socket-io )；并且⽆法兼容低版本的浏览器")])])]),s._v(" "),n("p",[s._v("HTTP 和 WebSocket 的连接通信比较图：")]),s._v(" "),n("img",{staticStyle:{zoom:"30%"},attrs:{src:a(5816),alt:"image-20210221101152845"}}),s._v(" "),n("h2",{attrs:{id:"_8-什么是浏览器同源策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-什么是浏览器同源策略"}},[s._v("#")]),s._v(" 8. 什么是浏览器同源策略？")]),s._v(" "),n("p",[s._v('首先，同源是指资源地址的 "协议 + 域名 + 端⼝" 三者都相同，即使两个不同域名指向了同⼀ IP 地址，也被判断为⾮同源。')]),s._v(" "),n("p",[s._v("下面是一些地址的同源判断示例：")]),s._v(" "),n("p",[s._v("以下不同地址的页面, 去请求一个接口: "),n("code",[s._v("http://store.company.com/getInfo")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(5817),alt:"image-20210221103114013"}})]),s._v(" "),n("p",[s._v("同源策略是 "),n("code",[s._v("浏览器")]),s._v(" 的一种⽤于隔离潜在恶意⽂件的重要安全保护机制 !!!  (服务器没有这个策略限制)")]),s._v(" "),n("p",[s._v("在浏览器中，⼤部分内容都受同源策略限制，除了以下三个资源获取类型的标签：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("<img>")])]),s._v(" "),n("li",[n("code",[s._v("<link>")])]),s._v(" "),n("li",[n("code",[s._v("script")])])]),s._v(" "),n("h2",{attrs:{id:"_9-如何实现跨域获取数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-如何实现跨域获取数据"}},[s._v("#")]),s._v(" 9. 如何实现跨域获取数据？")]),s._v(" "),n("p",[s._v("历史上出现过的跨域⼿段有很多，主要了解3种跨域⽅案：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("JSONP")])]),s._v(" "),n("li",[n("p",[s._v("CORS")])]),s._v(" "),n("li",[n("p",[s._v("服务器代理(webpack代理, Nginx反向代理)")])])]),s._v(" "),n("p",[n("strong",[s._v("JSONP")])]),s._v(" "),n("p",[s._v("这是一种非常经典的跨域方案，它利用了"),n("code",[s._v("<script>")]),s._v(" 标签不受同源策略的限制的特性，实现跨域效果。")]),s._v(" "),n("p",[s._v("优点：")]),s._v(" "),n("ul",[n("li",[s._v("实现简单")]),s._v(" "),n("li",[s._v("兼容性好")])]),s._v(" "),n("p",[s._v("缺点：")]),s._v(" "),n("ul",[n("li",[s._v("只支持 GET 请求 （因为 "),n("code",[s._v("<script>")]),s._v(" 标签只能发送 GET 请求）")]),s._v(" "),n("li",[s._v("存在被 XSS 攻击的可能，缺乏安全性保证")]),s._v(" "),n("li",[s._v("需要服务端配合改造")])]),s._v(" "),n("p",[s._v("axios中不支持 JSONP, 如果在开发中, 需要发送 JSONP 请求, 可以用 jsonp 插件")]),s._v(" "),n("p",[s._v("参考文档: "),n("a",{attrs:{href:"https://www.jianshu.com/p/720e453ca27d",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue 中JSONP 插件的使用"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("strong",[s._v("CORS")]),s._v(" (主流)")]),s._v(" "),n("p",[s._v("跨域资源共享（CORS），这是⽬前比较主流的跨域解决⽅案，")]),s._v(" "),n("p",[s._v("它利用一些额外的 HTTP 响应头来通知浏览器, 允许访问来自指定 origin 的非同源服务器上的资源。")]),s._v(" "),n("p",[s._v("Node.js 的 Express 框架的设置代码 (Java, PHP等, 配置代码差不多)：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建一个 CORS 中间件 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowCrossDomain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://example.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET,PUT,POST,DELETE'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Headers'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//...")]),s._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 为 Express 配置 CORS 中间件")]),s._v("\n  app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("allowCrossDomain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("所以, 开发中或上线时遇到跨域, 如果不考虑兼容性问题 (IE10+)")]),s._v(" "),n("p",[s._v("优先让后台配置个 CORS 解决即可, 简单快捷!")]),s._v(" "),n("p",[n("strong",[s._v("代理服务器")])]),s._v(" "),n("p",[s._v("说明: 同源策略, 是浏览器的安全策略, 服务器于服务器之间, 没有跨域问题! 所以可以利用代理服务器转发请求!")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("开发环境的跨域问题 (使用webpack代理服务器解决)")]),s._v(" "),n("p",[s._v("配置 devServer 的 proxy 配置项")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 代理配置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("proxy")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这里的api 表示如果我们的请求地址有/api的时候,就出触发代理机制")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'/api'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("target")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'www.baidu.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 我们要代理请求的地址")]),s._v("\n           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 路径重写")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("pathRewrite")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 路径重写  localhost:8888/api/login  => www.baidu.com/api/login")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'^/api'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 假设我们想把 localhost:8888/api/login 变成www.baidu.com/login 就需要这么做 ")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("生产环境的跨域问题 (使用 nginx 服务器代理)")]),s._v(" "),n("p",[s._v("博客参考: https://www.cnblogs.com/elfpower/p/8818759.html")]),s._v(" "),n("p",[n("img",{attrs:{src:a(5818),alt:"image-20210308005644520"}})])])])])}),[],!1,null,null,null);t.default=e.exports}}]);